# 结构体

## 结构体的定义及初始化

```rust
// 结构体
struct User {
    // 字段（field）
    active: bool,
    username: String,
    password: String,
    sign_in_count: u64,
}
fn main() {
    // 实例
    let mut user1 = User {
        active: true,
        sign_in_count: 1,
        username: String::from("someusername"),
        password: String::from("password"),
    };
    let user2 = build_user(String::from("user"));
    let user3 = User {
        // username 值为新值,其余值来自于user2
        username: String::from("user3"),
        // 使用user2中的值创建user3
        // !必须放在最后
        ..user2
    };
    // 可变实例可修改字段
    // !Rust 并不允许只将某个字段标记为可变
    user1.password = String::from("test");
}

fn build_user(username: String) -> User {
    User {
        active: true,
        username,
        password: String::from("init"),
        sign_in_count: 1,
    }
}

```

###  **元组结构体**

**元组结构体**（*tuple structs*）。元组结构体有着结构体名称提供的含义，但没有具体的字段名，只有字段的类型。当你想给整个元组取一个名字，并使元组成为与其他元组不同的类型时，

```rust
struct Color(i32, i32, i32);
```

### 没有任何字段的类单元结构体

**类单元结构体**（*unit-like structs*）因为它们类似于 `()`，即[“元组类型”](https://kaisery.github.io/trpl-zh-cn/ch03-02-data-types.html#元组类型)一节中提到的 unit 类型。类单元结构体常常在你想要在某个类型上实现 trait 但不需要在类型中存储数据的时候发挥作用

```rust
struct AlwaysEqual;

fn main() {
    let subject = AlwaysEqual;
}
```

### 结构体数据的所有权

确保结构体引用的数据有效性跟结构体本身保持一致

在结构体中存储一个引用而不指定生命周期将是无效的

```rust
struct User {
    active: bool,
    // 抛出错误,需要生命周期标记
    username: &str,
    email: &str,
    sign_in_count: u64,
}

fn main() {
    let user1 = User {
        active: true,
        username: "someusername123",
        email: "someone@example.com",
        sign_in_count: 1,
    };
}
```

### 结构体例子

```rust
struct Rectangle {
    width: u32,
    height: u32,
}

fn main() {
    // 元组
    let rect = (32, 10);
    // 结构体
    let rect2 = Rectangle {
        width: 32,
        height: 10,
    };
    println!("area is {}", area(rect));
    println!("area is {}", area2(&rect2));
}
fn area(rect: (u32, u32)) -> u32 {
    rect.0 * rect.1
}

fn area2(rect: &Rectangle) -> u32 {
    rect.width * rect.height
}
```

